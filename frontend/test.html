<!DOCTYPE html>
<html lang="en" ng-app="ChurchTVApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Church TV - Test Page</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
    <div class="container" style="margin-top: 50px;">
        <div class="row">
            <div class="col-md-12">
                <h1 class="text-center">
                    <i class="fa fa-tv"></i> Church TV Test Page
                </h1>
                <p class="text-center">Testing AngularJS application functionality</p>
                <hr>
            </div>
        </div>

        <!-- Test Navigation -->
        <div class="row">
            <div class="col-md-12">
                <div class="btn-group btn-group-justified" role="group">
                    <a href="#/" class="btn btn-default">Home</a>
                    <a href="#/search" class="btn btn-default">Search</a>
                    <a href="#/favorites" class="btn btn-default">Favorites</a>
                    <a href="#/category/sermons" class="btn btn-default">Sermons</a>
                </div>
                <br><br>
            </div>
        </div>

        <!-- API Connection Test -->
        <div class="row">
            <div class="col-md-6">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <h3 class="panel-title">API Connection Test</h3>
                    </div>
                    <div class="panel-body">
                        <button class="btn btn-primary" ng-click="testAPI()">Test API Connection</button>
                        <div ng-show="apiTestResult" class="alert" ng-class="apiTestSuccess ? 'alert-success' : 'alert-danger'" style="margin-top: 10px;">
                            <strong>{{apiTestSuccess ? 'Success!' : 'Error:'}}</strong> {{apiTestResult}}
                        </div>
                    </div>
                </div>
            </div>

            <!-- YouTube API Test -->
            <div class="col-md-6">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <h3 class="panel-title">YouTube API Test</h3>
                    </div>
                    <div class="panel-body">
                        <button class="btn btn-primary" ng-click="testYouTubeAPI()">Test YouTube API</button>
                        <div ng-show="youtubeTestResult" class="alert" ng-class="youtubeTestSuccess ? 'alert-success' : 'alert-danger'" style="margin-top: 10px;">
                            <strong>{{youtubeTestSuccess ? 'Success!' : 'Error:'}}</strong> {{youtubeTestResult}}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Services Test -->
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Services Test</h3>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-md-3">
                                <button class="btn btn-default btn-block" ng-click="testVideoService()">Video Service</button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-default btn-block" ng-click="testCategoryService()">Category Service</button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-default btn-block" ng-click="testSearchService()">Search Service</button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-default btn-block" ng-click="testUserService()">User Service</button>
                            </div>
                        </div>
                        <div ng-show="serviceTestResult" class="alert" ng-class="serviceTestSuccess ? 'alert-success' : 'alert-danger'" style="margin-top: 10px;">
                            <strong>{{serviceTestSuccess ? 'Success!' : 'Error:'}}</strong> {{serviceTestResult}}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Results Display -->
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Test Results & Debug Info</h3>
                    </div>
                    <div class="panel-body">
                        <h4>Application Status</h4>
                        <ul>
                            <li><strong>AngularJS Version:</strong> {{angular.version.full}}</li>
                            <li><strong>API Base URL:</strong> {{API_BASE}}</li>
                            <li><strong>YouTube API Key:</strong> {{YOUTUBE_API_KEY ? 'Configured' : 'Not Configured'}}</li>
                            <li><strong>Current Route:</strong> {{getCurrentRoute()}}</li>
                        </ul>

                        <h4>Local Storage Data</h4>
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Favorites: {{getFavoritesCount()}} items</h5>
                                <h5>Watch Later: {{getWatchLaterCount()}} items</h5>
                            </div>
                            <div class="col-md-6">
                                <h5>Search History: {{getSearchHistoryCount()}} items</h5>
                                <h5>Watch History: {{getWatchHistoryCount()}} items</h5>
                            </div>
                        </div>

                        <div class="btn-group" style="margin-top: 15px;">
                            <button class="btn btn-warning btn-sm" ng-click="clearAllData()">Clear All Data</button>
                            <button class="btn btn-info btn-sm" ng-click="reloadPage()">Reload Page</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error Log -->
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-danger">
                    <div class="panel-heading">
                        <h3 class="panel-title">Error Log</h3>
                    </div>
                    <div class="panel-body">
                        <div id="error-log" style="max-height: 200px; overflow-y: auto; background: #f8f8f8; padding: 10px; font-family: monospace; font-size: 12px;">
                            <!-- Errors will be logged here -->
                        </div>
                        <button class="btn btn-sm btn-default" ng-click="clearErrorLog()">Clear Log</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AngularJS Dependencies -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular-route.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular-animate.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular-sanitize.min.js"></script>

    <!-- jQuery and Bootstrap -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js"></script>

    <!-- Application Files -->
    <script src="app/app.js"></script>
    <script src="app/controllers/HomeController.js"></script>
    <script src="app/controllers/VideoController.js"></script>
    <script src="app/controllers/CategoryController.js"></script>
    <script src="app/controllers/SearchController.js"></script>
    <script src="app/controllers/FavoritesController.js"></script>
    <script src="app/services/VideoService.js"></script>
    <script src="app/services/CategoryService.js"></script>
    <script src="app/services/SearchService.js"></script>
    <script src="app/services/UserService.js"></script>
    <script src="app/directives/youtubePlayer.js"></script>
    <script src="app/directives/videoThumbnail.js"></script>

    <!-- Test Controller -->
    <script>
        angular.module('ChurchTVApp')
            .controller('TestController', ['$scope', '$http', 'API_BASE', 'YOUTUBE_API_KEY', 'VideoService', 'CategoryService', 'SearchService', 'UserService',
                function($scope, $http, API_BASE, YOUTUBE_API_KEY, VideoService, CategoryService, SearchService, UserService) {

                // Test results
                $scope.apiTestResult = '';
                $scope.apiTestSuccess = false;
                $scope.youtubeTestResult = '';
                $scope.youtubeTestSuccess = false;
                $scope.serviceTestResult = '';
                $scope.serviceTestSuccess = false;

                // Test API connection
                $scope.testAPI = function() {
                    $scope.apiTestResult = 'Testing API connection...';

                    $http.get(API_BASE + '/videos', { timeout: 10000 })
                        .then(function(response) {
                            $scope.apiTestSuccess = true;
                            $scope.apiTestResult = 'API connection successful! Found ' + (response.data.length || 0) + ' videos.';
                        })
                        .catch(function(error) {
                            $scope.apiTestSuccess = false;
                            $scope.apiTestResult = 'API connection failed: ' + (error.statusText || error.message || 'Unknown error');
                            logError('API Test Failed: ' + JSON.stringify(error));
                        });
                };

                // Test YouTube API
                $scope.testYouTubeAPI = function() {
                    $scope.youtubeTestResult = 'Testing YouTube API...';

                    if (!YOUTUBE_API_KEY) {
                        $scope.youtubeTestSuccess = false;
                        $scope.youtubeTestResult = 'YouTube API key not configured';
                        return;
                    }

                    // Simple API test - search for test query
                    var testUrl = 'https://www.googleapis.com/youtube/v3/search?part=snippet&q=test&maxResults=1&key=' + YOUTUBE_API_KEY;

                    $http.get(testUrl, { timeout: 10000 })
                        .then(function(response) {
                            $scope.youtubeTestSuccess = true;
                            $scope.youtubeTestResult = 'YouTube API working! Found ' + (response.data.items ? response.data.items.length : 0) + ' results.';
                        })
                        .catch(function(error) {
                            $scope.youtubeTestSuccess = false;
                            $scope.youtubeTestResult = 'YouTube API failed: ' + (error.data ? error.data.error.message : error.statusText);
                            logError('YouTube API Test Failed: ' + JSON.stringify(error));
                        });
                };

                // Test services
                $scope.testVideoService = function() {
                    $scope.serviceTestResult = 'Testing Video Service...';

                    VideoService.getFeaturedVideos(1)
                        .then(function(videos) {
                            $scope.serviceTestSuccess = true;
                            $scope.serviceTestResult = 'Video Service working! Retrieved ' + videos.length + ' featured videos.';
                        })
                        .catch(function(error) {
                            $scope.serviceTestSuccess = false;
                            $scope.serviceTestResult = 'Video Service failed: ' + error.message;
                            logError('Video Service Test Failed: ' + error.message);
                        });
                };

                $scope.testCategoryService = function() {
                    $scope.serviceTestResult = 'Testing Category Service...';

                    CategoryService.getCategories()
                        .then(function(categories) {
                            $scope.serviceTestSuccess = true;
                            $scope.serviceTestResult = 'Category Service working! Found ' + categories.length + ' categories.';
                        })
                        .catch(function(error) {
                            $scope.serviceTestSuccess = false;
                            $scope.serviceTestResult = 'Category Service failed: ' + error.message;
                            logError('Category Service Test Failed: ' + error.message);
                        });
                };

                $scope.testSearchService = function() {
                    $scope.serviceTestResult = 'Testing Search Service...';

                    SearchService.search('test', {}, 1, 1)
                        .then(function(results) {
                            $scope.serviceTestSuccess = true;
                            $scope.serviceTestResult = 'Search Service working! Found ' + results.total + ' results.';
                        })
                        .catch(function(error) {
                            $scope.serviceTestSuccess = false;
                            $scope.serviceTestResult = 'Search Service failed: ' + error.message;
                            logError('Search Service Test Failed: ' + error.message);
                        });
                };

                $scope.testUserService = function() {
                    $scope.serviceTestResult = 'Testing User Service...';

                    var favorites = UserService.getFavorites();
                    $scope.serviceTestSuccess = true;
                    $scope.serviceTestResult = 'User Service working! Found ' + favorites.length + ' favorites.';
                };

                // Utility functions
                $scope.getCurrentRoute = function() {
                    return window.location.hash || '/';
                };

                $scope.getFavoritesCount = function() {
                    return UserService.getFavorites().length;
                };

                $scope.getWatchLaterCount = function() {
                    return UserService.getWatchLater().length;
                };

                $scope.getSearchHistoryCount = function() {
                    return SearchService.getSearchHistory().length;
                };

                $scope.getWatchHistoryCount = function() {
                    return UserService.getWatchHistory().length;
                };

                $scope.clearAllData = function() {
                    if (confirm('Are you sure you want to clear all user data?')) {
                        UserService.clearAllData();
                        SearchService.clearHistory();
                        alert('All data cleared!');
                        location.reload();
                    }
                };

                $scope.reloadPage = function() {
                    location.reload();
                };

                $scope.clearErrorLog = function() {
                    document.getElementById('error-log').innerHTML = '';
                };

                // Error logging
                function logError(message) {
                    var errorLog = document.getElementById('error-log');
                    var timestamp = new Date().toLocaleTimeString();
                    errorLog.innerHTML += '<div>[' + timestamp + '] ' + message + '</div>';
                    errorLog.scrollTop = errorLog.scrollHeight;
                }

                // Global error handler
                window.addEventListener('error', function(e) {
                    logError('JavaScript Error: ' + e.message + ' at ' + e.filename + ':' + e.lineno);
                });

                // Auto-run basic tests
                setTimeout(function() {
                    if (!$scope.apiTestResult) {
                        $scope.testAPI();
                        $scope.$apply();
                    }
                }, 1000);
            }]);
    </script>

    <!-- Test controller -->
    <div ng-controller="TestController" style="display: none;"></div>
</body>
</html>